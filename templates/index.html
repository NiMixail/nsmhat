<!DOCTYPE html>
<html>
<head>
    <title>–®NSM</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <style>

        body {
            font-family: Arial;
            color: #e1e1e1;
        }

        .container {
            display: flex;
        }

        #vanta-container {
            height: 150vh;
        }

        #header {
            background-color: rgba(255, 255, 255, 0.2);
            text-align: center;
            padding: 10px 0;
        }

        #words-display {
            position: fixed;
            top: 30;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        #buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 250px;
        }

        .button {
            font-family: Bahnschrift;
            font-stretch: condensed;
            background-color: #FFFFFF;
            border: none;
            color: black;
            padding: 4px 4px;
            text-align: center;
            font-size: 18px;
            margin: 2px 4px;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            opacity: 0.8;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        #wordContainer {
            background-color: rgba(255, 255, 255, 0.2);
            text-align: center;
            margin-top: 20px;
        }

        #generateBtn, #okBtn, #send-button {
            margin-left: auto;
            margin-right: auto;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 2px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .button:focus, #popBtn:focus, #clearBtn:focus, #generateBtn:focus, #okBtn:focus, #leftBtn:focus, #rightBtn:focus {
            outline: white solid 1px;
        }

        .button:hover, #popBtn, #clearBtn, #generateBtn, #okBtn, #leftBtn, #rightBtn, #send-button {
            //display: block;
            border: none;
            background-color: transparent;
            color: gray;
            cursor: pointer;
            transition: transform 0.3s;
        }

        #popBtn img {
            width: 30px;
            height: 30px;
            filter: invert(1);
        }

        #clearBtn img {
            width: 30px;
            height: 30px;
            opacity: 0.7;
            filter: invert(1);
        }

        .button:hover, #popBtn:hover, #clearBtn:hover, #generateBtn:hover, #okBtn:hover, #leftBtn:hover, #rightBtn:hover, #send-button:hover {
            transform: scale(1.1);
        }

        #nickname-form {
            text-align: center;
            margin-top: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #nameInput, #message-input {
            filter: invert(1);
        }

        #chat-messages {
          height: 200px;
          overflow-y: scroll;
          overflow-x: hidden;
          scroll-behavior: smooth;
        }

        #chat-messages::-webkit-scrollbar {
          display: none;
        }
        #chat-messages {
          scrollbar-width: none; /* Firefox */
        }

        table {
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            width: 20%;
            border-collapse: collapse;
            margin-top: 20px;
            opacity: 0.95;
        }

        th, td {
            padding: 3px;
            border: 0px solid #ddd;
            text-align: center;
        }

        th {
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
        }

        #words-display {
            font-size: 18px;
            text-align: center;
            margin-top: 20px;
        }

        #user-info {
            text-align: center;
            margin-top: 20px;
            margin-left: 20px;
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }}
        
        .cursor {
            color: cyan;
            animation: blink 1s infinite;

          .box {
              display: inline-block;
              width: 100px;
              height: 100px;
              background-color: #ccc;
              margin: 10px;
          }
        }
    </style>
</head>

<body>
<div id="vanta-container">
<div id="header">
    <h5><b>–®–ª—è–ø–∞ NSM</b> üéÑ –ø—Ä–∏–¥—É–º–∞–Ω–æ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ NiMixail ¬© 2023‚Äî2024</h5>
</div>

<div id="words-display">
    {% for word in words %}
    {{ word }}
    {% endfor %}
</div>

<div id="buttons-container">
    <button id="clearBtn"><img
          src="https://cdn-icons-png.flaticon.com/512/63/63481.png">
    </button>
  
    <button class="button" id="–æ–ø–∏" style="background-color: #FFFFF0"><i><u>–û–ü–ò–°–´–í–ê–ï–ú–û–ï</u></i></button>
    <button class="button" id="." style="background-color: #FFFFF0">.„Ö§</button>
    <button class="button" id="," style="background-color: #FFFFF0">,</button>
    <button class="button" id="!" style="background-color: #FFFFF0">!</button>
    <button class="button" id="—Ö—Ö—Ö" style="background-color: #FFFFF0">ùó´</button>
    <button class="button" id="—É—É—É" style="background-color: #FFFFF0">ùó¨</button>
    <button class="button" id="–∑–∑–∑" style="background-color: #FFFFF0">ùó≠</button>
    <button class="button" id="—à—à—à" style="background-color: #FFFFF0">ùó™</button>
    <button class="button" id="—ç—Ç–æ" style="background-color: #FFFFF0">–≠–¢–û–¢</button>
    <button class="button" id="—Å–µ–±" style="background-color: #FFFFF0">–°–ï–ë–Ø</button>
    <button class="button" id="–∏–∏–∏" style="background-color: #FFFFF0">–ò</button>
    <button class="button" id="—Ç–∞–∫" style="background-color: #FFFFF0">–¢–ê–ö–û–ô:</button>

    <button class="button" id="–∞–Ω—Ç" style="background-color: #D0D0D0">–ê–ù–¢–ò-</button>
    <button class="button" id="–Ω–µ–µ" style="background-color: #D0D0D0">–ù–ï</button>
    <button class="button" id="–æ—á–µ" style="background-color: #D0D0D0">–û–ß–ï–ù–¨</button>
    <button class="button" id="–∫–∞–∫" style="background-color: #D0D0D0">–ö–ê–ö</button>
    <button class="button" id="–±–æ–ª" style="background-color: #D0D0D0">–ë–û–õ–ï–ï –ß–ï–ú</button>

    <button class="button" id="—á–µ–ª" style="background-color: #CCCCFF">–ß–ï–õ–û–í–ï–ö</button>
    <button class="button" id="—á—Ç–æ" style="background-color: #CCCCFF">–ß–¢–û-–¢–û</button>
    <button class="button" id="—Å–≤–æ" style="background-color: #CCCCFF">–°–í–û–ô–°–¢–í–û</button>
    <button class="button" id="—Ä–∞–∑" style="background-color: #CCCCFF">–†–ê–ó–ù–û–í–ò–î–ù–û–°–¢–¨</button>
    <button class="button" id="—á–∞—Å" style="background-color: #CCCCFF">–ß–ê–°–¢–¨</button>
    <button class="button" id="–∫–æ–ª" style="background-color: #CCCCFF">–ö–û–õ–ò–ß–ï–°–¢–í–û</button>

    <button class="button" id="–æ–¥–∏" style="background-color: #E3A9BE">–û–î–ò–ù–ê–ö–û–í–û</button>
    <button class="button" id="–¥—Ä—É" style="background-color: #E3A9BE">–î–†–£–ì–û–ô</button>
    <button class="button" id="–Ω–µ–∫" style="background-color: #E3A9BE">–ù–ï–ö–û–¢–û–†–´–ô</button>
    <button class="button" id="–≤—Å–µ" style="background-color: #E3A9BE">–í–°–ï</button>
    <button class="button" id="–æ–¥–∏" style="background-color: #E3A9BE">–û–î–ò–ù</button>

    <button class="button" id="–±–æ–ª" style="background-color: #FFFF99">–ë–û–õ–¨–®–û–ô</button>
    <button class="button" id="—Ö–æ—Ä" style="background-color: #FFFF99">–•–û–†–û–®–ò–ô</button>

    <button class="button" id="–∂–∏—Ç" style="background-color: #FFE2B7">–ñ–ò–¢–¨</button>
    <button class="button" id="–¥—É–º" style="background-color: #FFE2B7">–î–£–ú–ê–¢–¨</button>
    <button class="button" id="–∑–Ω–∞" style="background-color: #FFE2B7">–ó–ù–ê–¢–¨</button>
    <button class="button" id="—Ö–æ—Ç" style="background-color: #FFE2B7">–•–û–¢–ï–¢–¨</button>
    <button class="button" id="—á—É–≤" style="background-color: #FFE2B7">–ß–£–í–°–¢–í–û–í–ê–¢–¨</button>
    <button class="button" id="–≤–∏–¥" style="background-color: #FFE2B7">–í–ò–î–ï–¢–¨</button>
    <button class="button" id="—Å–ª—ã" style="background-color: #FFE2B7">–°–õ–´–®–ê–¢–¨</button>

    <button class="button" id="–≥–æ–≤" style="background-color: #C7FCEC">–ì–û–í–û–†–ò–¢–¨</button>
    <button class="button" id="—è—è—è" style="background-color: #C7FCEC">–Ø</button>
    <button class="button" id="–∏—Å—Ç" style="background-color: #C7FCEC">–ò–°–¢–ò–ù–ê</button>

    <button class="button" id="–±—ã—Ç" style="background-color: #D0F0C0">–ë–´–¢–¨</button>
    <button class="button" id="—Å–ª—É" style="background-color: #D0F0C0">–°–õ–£–ß–ê–¢–¨–°–Ø</button>
    <button class="button" id="–∏–º–µ" style="background-color: #D0F0C0">–ò–ú–ï–¢–¨</button>
    <button class="button" id="–º–æ—á" style="background-color: #D0F0C0">–ú–û–ß–¨</button>
    <button class="button" id="–¥–µ–ª" style="background-color: #D0F0C0">–î–ï–õ–ê–¢–¨</button>
    <button class="button" id="—Å–ø–æ" style="background-color: #D0F0C0">–° –ü–û–ú–û–©–¨–Æ</button>
    <button class="button" id="–Ω–∞—á" style="background-color: #D0F0C0">–ù–ê–ß–ê–¢–¨</button>
    <button class="button" id="–∏–∑–∑" style="background-color: #D0F0C0">–ò–ó-–ó–ê</button>
    <button class="button" id="—Ç–æ–≥" style="background-color: #D0F0C0">- –¢–û–ì–î–ê</button>

    <button class="button" id="–≤—Ä–µ" style="background-color: #99FF99">–í–†–ï–ú–Ø</button>
    <button class="button" id="–¥–æ–æ" style="background-color: #99FF99">–î–û</button>
    <button class="button" id="–¥–≤–∏" style="background-color: #99FF99">–î–í–ò–ì–ê–¢–¨–°–Ø</button>

    <button class="button" id="–≤–≤–≤" style="background-color: #DABDAB">–í</button>
    <button class="button" id="–Ω–∞–∞" style="background-color: #DABDAB">–ù–ê</button>
    <button class="button" id="–∫–∫–∫" style="background-color: #DABDAB">–ö</button>
    <button class="button" id="–º–µ—Å" style="background-color: #DABDAB">–ú–ï–°–¢–û</button>
    <button class="button" id="–Ω–∞–ø" style="background-color: #DABDAB">–ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï</button>
    <button class="button" id="–≤–µ—Ä" style="background-color: #DABDAB">–í–ï–†–•</button>
    <button class="button" id="—Ä–∞—Å" style="background-color: #DABDAB">–†–ê–°–°–¢–û–Ø–ù–ò–ï</button>
    <button class="button" id="—Å—Ç–æ" style="background-color: #DABDAB">–°–¢–û–†–û–ù–ê</button>
    <button class="button" id="–∫–∞—Å" style="background-color: #DABDAB">–ö–ê–°–ê–¢–¨–°–Ø</button>

    <button id="popBtn"><img
            src="https://cdn3.iconfinder.com/data/icons/social-productivity-line-art-3/128/delete-1024.png">
    </button>

    <button id="leftBtn"> <b> < </b> </button>
    <button id="rightBtn"> <b> > </b> </button>
</div>

<div>
    <!-- <button id="generateBtn">–°–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ</button> -->
    <div id=wordContainer> </div>
</div>

<div class="container">
<div id="nickname-form" class="container" class="box">
    <div class="row">
        <form method="POST" action="/" class="col-sm">
            <input type="text" name="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫" id="nameInput">
            <button type="submit" id="okBtn">–û–ö</button>
        </form>
        <p class="col-sm">–í–∞—à –Ω–∏–∫: <b id="me">...</b></p>
        <p class="col-sm">–°–µ–π—á–∞—Å –æ–±—ä—è—Å–Ω—è–µ—Ç: <b id="current">...</b></p>
      
        <p class="col-sm">
          <div id="chat" class="box">
              <input type="text" id="message-input" placeholder="–í–≤–æ–¥...">
              <button id="send-button">‚ñ∂</button>
              <div id="chat-messages"></div>
          </div>
        </p>
    </div>
</div>

  

<div id="user-info" class="box">
    <table>
        <thead>
        <tr>
            <th>–ù–∏–∫</th>
            <th>–û—á–∫–∏</th>
            <!--<th>–û–Ω–ª–∞–π–Ω?</th>-->
        </tr>
        </thead>
        <tbody id="userTableBody">
        </tbody>
    </table>
</div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js">
</script>
<script>
    const nickname = "{{ nickname }}";
    ip = '';
    current_user = "{{ current_user }}";
    users = "Loading...";
    words = [];
    cursor_pos = 0;

    const socket = io.connect('https://47de1adf-313d-4a87-910c-c6e65b7d3e44-00-70jud9jx0bpg.spock.replit.dev/');

    function addButtonClickEvent(button) {
        button.addEventListener('click', function () {
            if (ip == current_user) {
            const word = button.textContent;
            socket.emit('button_click', {word: word, cursor: cursor_pos});
            }
        });
    }

    const buttons = document.getElementsByClassName('button');
    for (const button of buttons) {
        addButtonClickEvent(button);
    }

    const popBtn = document.getElementById('popBtn');
    popBtn.addEventListener('click', function () {
        if (ip == current_user) 
        { socket.emit('pop_button_click', {cursor: cursor_pos}); }
        });

    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    leftBtn.addEventListener('click', function(){ arrow(false) });
    rightBtn.addEventListener('click', function(){ arrow(true) });
  
    const clearBtn = document.getElementById('clearBtn');
    clearBtn.addEventListener('click', function () {
        if (ip == current_user) { socket.emit('clear_button_click'); }
        });

  const chatMessages = document.getElementById("chat-messages");
  const messageInput = document.getElementById("message-input");
  const sendButton = document.getElementById("send-button");
  sendButton.addEventListener("click", () => {
      const message = messageInput.value;
      if (message && (ip != current_user)) {
          socket.emit('append_message', {nickname: ip, message: message.slice(-40)});
          messageInput.value = "";
      }
  });
  const inputField = document.getElementById('message-input'); 
  inputField.addEventListener('keydown', function(event) {
      const message = messageInput.value;
      if (event.keyCode === 13 && message) {
        if (ip != current_user) {      
              socket.emit('append_message', {nickname: ip, message: message.slice(-40)});
        }
        messageInput.value = "";
      }
      });

 inputField.addEventListener('input', function(event) {
      const message = messageInput.value;
     if (ip == current_user && (message.length == 3 || ",.!".includes(message))) {
          messageInput.value = "";
          document.getElementById(message).click();
      }
    });

function displayWords() {
  const wordsDisplay = document.getElementById('words-display');
  let text;
  if (cursor_pos == 0) {
      text = words.join(' ');
      }
  else {
      text = words.slice(0, cursor_pos).join(' ') + '<span class="cursor">|</span>' + words.slice(cursor_pos).join(' ');
      }
  wordsDisplay.innerHTML = text.replace(/–û–ü–ò–°–´–í–ê–ï–ú–û–ï/g, '<i>–û–ü–ò–°–´–í–ê–ï–ú–û–ï</i>').replace(/\s+(?=[.,!])/g, '');
}

function arrow(right) {
  if (right) {
    cursor_pos = Math.min(cursor_pos + 1, 0);
  }
  else {
    cursor_pos = Math.max(cursor_pos - 1, -words.length);
  }
  displayWords();
}
  
socket.on('word_added', function (data) {
        words = data.words;
        displayWords();
    });
  
document.addEventListener("keydown", function(event) {
  if (event.key === "ArrowLeft") {arrow(false)}
  if (event.key === "ArrowRight") {arrow(true)}
  if ((event.key === "Delete") && (ip == current_user)) {
      socket.emit('pop_button_click', {cursor: cursor_pos});
  }
});

socket.on('ip_address', function (data) {
        const userIpElement = document.getElementById('me');
        ip = data.ip;
        userIpElement.textContent = ipToNickname(ip);
    });
    
socket.on('current', function (data) {
        const currentNickname = document.getElementById('current');
        const wordContainer = document.getElementById('wordContainer');
        const myNickname = document.getElementById('me');
        current_user = data.current_ip
        currentNickname.textContent = ipToNickname(current_user);
        myNickname.textContent = ipToNickname(ip);
        if (current_user == ip) {
            if (data.word == '') {socket.emit('new_guessed_word');}
            wordContainer.textContent = '–í—ã –æ–±—ä—è—Å–Ω—è–µ—Ç–µ —Å–ª–æ–≤–æ: ' + data.word;
        }
        else {wordContainer.textContent = 'ü§î'}
        //location.reload();
       });

socket.on('update_chat', function (data) {
    chatMessages.innerHTML = '';
    for (const tuple of data.chat) {
      appendMessage(tuple[0], tuple[1]);
    }
    chatMessages.scrollTop = chatMessages.scrollHeight;
});

socket.on('yay', function (data) {
      window.alert("–ò–≥—Ä–æ–∫ " + ipToNickname(data.old) + " –æ–±—ä—è—Å–Ω—è–ª —Å–ª–æ–≤–æ '" + data.word + "'! –û—Ç–≥–∞–¥–∞–ª –µ–≥–æ –∏ —Ç–µ–ø–µ—Ä—å –æ–±—ä—è—Å–Ω—è–µ—Ç: " + ipToNickname(data.new));
  });

function appendMessage(sender, text) {
    const messageElement = document.createElement("div");
    messageElement.innerHTML = `<strong>${ipToNickname(sender)}:</strong> ${text}`;
    chatMessages.appendChild(messageElement);
}

socket.on('user_list', function (data) {
    const userTableBody = document.getElementById('userTableBody');
    userTableBody.innerHTML = '';
    users = data.users;

    users.forEach(user => {
        const row = document.createElement('tr');
        const nicknameCell = document.createElement('td');
        const pointsCell = document.createElement('td');
        const onlineCell = document.createElement('td');

        nicknameCell.textContent = user.nickname;
        pointsCell.textContent = user.points;
        if (user.online) { onlineCell.textContent = '‚úì'; }
        else { onlineCell.textContent = '‚úï';}

        //nicknameCell.addEventListener('click', function () {
        //    if ((nickname==current_user) && (nicknameCell.textContent != nickname) &&
        //    confirm('–°–¥–µ–ª–∞—Ç—å –∏–≥—Ä–æ–∫–∞ ' + nicknameCell.textContent + ' –æ–±—ä—è—Å–Ω—è—é—â–∏–º?'))
        //    {socket.emit('next_user', {nickname: user.nickname});
        //    socket.emit('new_guessed_word');}
        //});
        row.appendChild(nicknameCell);
        row.appendChild(pointsCell);
        //row.appendChild(onlineCell);
        userTableBody.appendChild(row);
    });
});


function getRandomWord() {
    const randomIndex = Math.floor(Math.random() * tobeguessed.length);
    return tobeguessed[randomIndex];
}

        //const randomWord = getRandomWord();
        //wordContainer.textContent = `${randomWord}`;}
    
// for console
function editPoints(ip, delta) {
    socket.emit('edit_points', {ip: ip, delta: delta});
}

function ipToNickname(ip_) {
    if (ip_ == '_sys_') {
        return '–®NSM';
    }
    for (const u of users) {
        if (u.ip == ip_) {
            return u.nickname;
        }
    }
    return '???';
}
    
const nameInput = document.getElementById('nameInput');
// const okBtn = document.getElementById('okBtn');
// okBtn.addEventListener('click', function f() {
  //okBtn.style.display = 'none'; nameInput.style.display = 'none';
// });
    
//const generateBtn = document.getElementById('generateBtn');
//generateBtn.addEventListener('click', newGuessedWord);
</script>
</div>
</body>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>
<script>
    VANTA.FOG({
      el: "#vanta-container",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      highlightColor: 0x2c1305,
      midtoneColor: 0x60638,
      lowlightColor: 0x15924,
      baseColor: 0xb0213,
      blurFactor: 0.90,
      speed: 1.50,
      zoom: 1.50
    })
</script>
    
</html>
